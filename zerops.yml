zerops:
  - setup: backend
    build:
      base: nodejs@20
      buildCommands:
        - |
          cd backend
          yarn
          yarn build
      deployFiles:
        - ./backend/~
    run:
      base: nodejs@20
      envVariables:
        DATABASE_TYPE: postgres
        DATABASE_URL: postgresql://${db_user}:${db_password}@db:5432/${db_hostname}
        MINIO_BUCKET: ${storage_bucketName}
        MINIO_ENDPOINT: ${storage_apiUrl}
      REDIS_URL: redis://redis:6379
      initCommands:
        - zsc execOnce $appVersionId npx medusa migrations run
        - zsc execOnce $appVersionId npx medusa links sync
        - zsc execOnce initialize npx medusa exec ./src/scripts/seed.ts
        - zsc execOnce initialize npx medusa user -e admin@email.com -p supersecret
      start: yarn start
